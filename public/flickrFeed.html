<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Flickr Feed API</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="jquery-3.1.1.min.js"></script>

    <style media="screen">
      #post {
        border: 1px solid red;
        padding: 15px;
      }

      #post:nth-child(4n+1) {
        clear: left;
      }


    </style>

  </head>
  <body>
    <div class="container" id="feed">

      <div class="row" id="row">

      </div>

    </div>



    <script type="text/html" id="template">
      <div class="col-lg-3" id="post">
        <img class="col-lg-12" id="image" src=<%= imageLink %> />
        <p class="col-lg-12" id="headline"><a href=<%= titleLink %> id="title"><%= title %></a> by <a href=<%= authorLink %> id="author"><%= authorName %></a></p>
        <p class="col-lg-12" id="tags">Tags: <%= tags %></p>
      </div>

    </script>

    <script>

      var postTemplate = _.template($("#template").html());

      $.ajax({
        type: "GET",
        dataType: "jsonp",
        url: "https://api.flickr.com/services/feeds/photos_public.gne?format=json"
      });

      function jsonFlickrFeed(json) {
        $.each(json.items, function(i, item) {

          const imageURL = item.media.m;
          const imagePage = item.link;
          const imageTitle = (item.title == " " ? "Untitled" : item.title);
          const imageAuthor = createAuthor(item.author);
          const authorURL = "https://www.flickr.com/people/" + item.author_id;
          const imageTags = splitTags(item.tags);

          var postValues = {
            imageLink: imageURL,
            titleLink: imagePage,
            title: imageTitle,
            authorLink: authorURL,
            authorName: imageAuthor,
            tags: imageTags
          }

          $('#row').append(postTemplate(postValues));

        });
      };

      function splitTags(tags) {
        return tags.split(" ").join(", ");
      };

      function createAuthor(author) {
        return author.split(/[""]/)[1];
      };


    </script>
  </body>
</html>
